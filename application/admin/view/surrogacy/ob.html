<!DOCTYPE html>
<html lang="en">
<head>
    <title>Home - Obstetric History</title>

    <!-- Page Head Start-->
    {include file="fa/css" /}
    <!-- Page Head Start-->

    <style>
        .card {
            width: 100%;
        }
        body {
            margin: 0px !important;
            padding: 0px !important;
        }
        .container-fluid {
            padding: 0px !important;

        }
        .form-check{
            display: inline-block !important;
        }

        .page-body-wrapper .page-body {
            margin: 0px !important;
        }
        /*.page-wrapper.compact-wrapper .page-body-wrapper .page-body {*/
        /*    margin-top: 24px;*/
        /*}*/
        .ws_jindu {
            display: flex;
            justify-content: space-between;
        }
        .ws_prodess {
            margin-top: 5px;width: 75%
        }
        .page-title{
            padding-bottom: 0px !important;
        }
        @media only screen and (min-width:768px) and (max-width:992px) {
            .ws_prodess_r {
                padding-left: 20px;
            }
        }
        /* phone */
        @media only screen and (max-width:767px) {
            .ws_prodess {
                margin-top: 5px;width: 55%
            }
            .ws_prodess_r {
                padding-left: 18px;
            }
        }
        .ws_display_none{
            display: none;
        }
        .ws_display {
            display: inline-block;
        }
    </style>
</head>
<body>
<!-- tap on top starts-->
<div class="tap-top"><i data-feather="chevrons-up"></i></div>
<!-- tap on tap ends-->

<!-- page-wrapper Start-->
<div class="page-wrapper compact-wrapper" id="pageWrapper">

    <!-- Page Body Start-->
    <div class="page-body-wrapper">

        <!-- Page content Start-->
        <div class="page-body">
            <div class="container-fluid">
                <div class="page-title">
                    <div class="row">
                        <div class="col-6">
                            <h3>Obstetric History</h3>
                        </div>
                        <div class="col-6">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="{:url('user/user/detail',['ids'=>$uid])}">
                                    <i data-feather="home"></i></a></li>
                                <li class="breadcrumb-item">
                                    <!--                                    <a  style="cursor:pointer;" onClick="javascript :history.back(-1);"> Forms</a>-->
                                    <a  style="cursor:pointer;" href="{:url('user/user/detail',['ids'=>$uid])}"> Forms</a>
                                </li>
                                <li class="breadcrumb-item active">Obstetric History</li>
                            </ol>
                        </div>
                        <div class="col-12">

                            <div class="card-body progress-showcase">
                                <div class="ws_jindu">
                                    <div>
                                        {$form_number} required questions
                                    </div>
                                    <div class="col col-9 ws_prodess" >
                                        <div class="progress">
                                            <div class="progress-bar bg-info" role="progressbar" style="width: {$lv}%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    <div class="ws_prodess_r">
                                        {if condition="$row"} {$row.form_complate_number}/{$form_number} complate
                                        {else}
                                        0/{$form_number} complate
                                        {/if}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Container-fluid starts-->

            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">

                        <div class="card">

                            <div class="card-body">
                                <form class="row g-3 " id="obstetric_history" method="POST" action="" role="form" onsubmit="return sumbit_sure()">

                                    <div class="col-md-12 m-b-10  position-relative">
                                        <label class="form-label" >When is your last period? *</label>
                                        <input type="text"  name="last_period_time"
                                               class="form-control datetimepicker"  data-rule="required" data-date-format="MM/DD/YYYY"

                                               {if condition="$row"}value="{$row.last_period_time|htmlentities}"{/if}  />
                                    </div>
                                    <div class="col-md-6  m-b-10  position-relative">
                                        <label class="form-label" >How many days of bleeding? *</label>
                                        <input name="days_of_bleed"  class="form-control" data-rule="required" type="text" {if condition="$row"} value="{$row.days_of_bleed|htmlentities}"{/if} >
                                    </div>
                                    <div class="col-md-6 m-b-10 position-relative">
                                        <label class="form-label" >How many days between each period? *</label>
                                        <input name="days_between"  class="form-control" data-rule="required" type="text" {if condition="$row"} value="{$row.days_between|htmlentities}"{/if}>
                                    </div>
                                    <div class="col-md-12  position-relative">
                                        <label class="form-label">Do you have regular menstrual cycles? *</label>

                                        <div class="form-label">
                                            <div class="form-check form-check-inline radio radio-primary">
                                                <input class="form-check-input" id="radioinline90" type="radio" data-rule="checked" name="is_menstruation_regular" value="1"
                                                       {if condition="$row&&$row.is_menstruation_regular eq '1'"} checked{/if}
                                                >
                                                <label class="form-check-label mb-0" for="radioinline90">Yes</label>
                                            </div>
                                            <div class="form-check form-check-inline radio radio-primary">
                                                <input class="form-check-input" id="radioinline91" type="radio" data-rule="checked" name="is_menstruation_regular" value="2"
                                                       {if condition="$row&&$row.is_menstruation_regular eq '2'"} checked{/if}
                                                >
                                                <label class="form-check-label mb-0" for="radioinline91">No</label>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="col-md-6 position-relative m-b-10">
                                        <label class="form-label" >Amount of bleeding ? *</label>
                                        <select class="form-select"  name="amount_of_bleed" >
                                            <option  value="0" {if condition="$row&&$row.amount_of_bleed eq '0'"} selected{/if}>Light</option>
                                            <option  value="1" {if condition="$row&&$row.amount_of_bleed eq '1'"} selected{/if}>Medium</option>
                                            <option  value="2" {if condition="$row&&$row.amount_of_bleed eq '2'"} selected{/if}>Heavy</option>
                                        </select>
                                    </div>
                                    <div class="col-md-12 position-relative">
                                        <label class="form-label" >When was your last pap smear and the result? *</label>
                                        <textarea class="form-control" id="exampleFormControlTextarea4" name="smear_result" data-rule="required" rows="3">{if condition="$row"}{$row.smear_result|htmlentities}{/if}</textarea>
                                    </div>


                                    <div class="col-sm-12" id="ws_row">
                                        <div class="col-md-12 m-b-10  ">
                                            <button class="btn
                                            {if condition="$button_number"}ws_display_none{/if}
                                            btn-primary add_baby ws_btn"  a="0" type="button" style="margin-left: 40%">Add Delivery</button>
                                        </div>

                                        {if condition="$surrogate_baby_data"}
                                        {foreach name='surrogate_baby_data' item='v' key='k' }
                                        <div class="col-xl-12  ws_card" >
                                            <div class="card recent-order">
                                                <div class="card-header pb-0">
                                                    <h3>Delivery #{$k+1}</h3>
                                                    <div class="card-header-right">
                                                        <ul class="list-unstyled card-option" style="width: 230px;">
                                                            <li><i class="icofont icofont-error close-card ws_del"></i></li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="card-body pb-0 m-b-30 m-t-20">
                                                    <div class="col-md-4 m-t-10 position-relative">
                                                        <label class="form-label" >Date of delivery *</label>
                                                        <!--                                        <input name="birthday_time[]" value="{$v.birthday_time}" class="form-control datepicker-here  digits" type="text" data-language="en">-->
                                                        <input type="text"  name="birthday_time[]" value="{$v.birthday_time_a}" class="form-control datetimepicker"  data-field="required" data-date-format="MM/DD/YYYY"/>
                                                    </div>
                                                    <div class="col-md-4 m-t-10 position-relative">
                                                        <label class="form-label">Sex *</label><!--性取向-->
                                                        <select class="form-select"  name="sex[]" required="">
                                                            <option  value="0"  {if condition="$v.sex eq '0'"} selected{/if} >Male</option>
                                                            <option  value="1"  {if condition="$v.sex eq '1'"} selected{/if}>Female</option>
                                                        </select>
                                                    </div>

                                                    <input name="baby[]"  value="{$v.baby}" class="form-control" readonly type="hidden"  >

                                                    <div class="col-md-4 m-t-10 position-relative">
                                                        <label class="form-label" >Gestational week at birth *</label>
                                                        <input name="fetal_age[]"  value="{$v.fetal_age}" class="form-control " data-rule="required" type="number" placeholder="week" min="0">
                                                    </div>
                                                    <div class="col-md-4 m-t-10 position-relative">
                                                        <label class="form-label" >Birth weight *</label>
                                                        <input name="weight[]"  value="{$v.weight}" class="form-control " data-rule="required" type="text">
                                                    </div>
                                                    <div class="col-md-4 m-t-10 position-relative">
                                                        <label class="form-label" >Birth height *</label>
                                                        <input name="height[]"  value="{$v.height}" class="form-control " data-rule="required" type="text" >
                                                    </div>

                                                    <div class="col-md-4 m-t-10 position-relative">
                                                        <label class="form-label">Delivery type *</label>
                                                        <select class="form-select"  name="pregnancy_type[]" required="">
                                                            <option  value="0"  {if condition="$v.pregnancy_type eq '0'"} selected{/if} >vaginal</option>
                                                            <option  value="1"  {if condition="$v.pregnancy_type eq '1'"} selected{/if}>c-section</option>
                                                        </select>
                                                    </div>

                                                    <div class="col-md-12 m-t-10 position-relative">
                                                        <label class="form-label" >Are there any complications? (If yes, please specify): *</label>
                                                        <input name="complications[]"  class="form-control " data-rule="required" type="text"  value="{$v.complications}">
                                                    </div>
                                                    <div class="col-md-12 m-t-10 position-relative">
                                                        <label class="form-label">Is this a surrogacy pregnancy? *</label>

                                                        <div class="form-label">
                                                            <div class="form-check form-check-inline radio radio-primary">
                                                                <input class="form-check-input" id="radioinline190{$k+30}" type="radio" data-rule="checked" name="is_surrogacy_pregnancy[{$k}]" value="1"
                                                                       {if condition="$v&&$v.is_surrogacy_pregnancy eq '1'"} checked{/if}
                                                                >
                                                                <label class="form-check-label mb-0" for="radioinline190{$k+30}">Yes</label>
                                                            </div>
                                                            <div class="form-check form-check-inline radio radio-primary">
                                                                <input class="form-check-input" id="radioinline191{$k+60}" type="radio" data-rule="checked" name="is_surrogacy_pregnancy[{$k}]" value="2"
                                                                       {if condition="$v&&$v.is_surrogacy_pregnancy eq '2'"} checked{/if}
                                                                >
                                                                <label class="form-check-label mb-0" for="radioinline191{$k+60}">No</label>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div class="col-md-12 m-t-20">
                                                        <button class="btn btn-primary add_baby
                                        {if condition="($button_number-1)!=$k"} ws_display_none{/if}
                                                        ws_btn"  a="{$k+1}" type="button" style="margin-left: 40%">Add Delivery</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {/foreach}
                                        {/if}

                                    </div>


                                    <input class="form-control"  name="uid" type="hidden"  value="{$uid}" >
                                    <input class="form-control"  id="form_complate_number" name="form_complate_number" type="hidden" value="0" >
                                    <input class="form-control"   name="status" type="hidden"  value="0">

                                    <div class="col-md-12 m-t-10 position-relative">
                                        <label class="form-label">Is there a history of abortions? *</label>
                                        <div class="form-label">
                                            <div class="form-check form-check-inline radio radio-primary">
                                                <input class="form-check-input" id="radioinline13" type="radio"  data-rule="checked" name="is_artificial_abortion" value="1"
                                                       {if condition="$row&&$row.is_artificial_abortion eq '1'"} checked{/if}
                                                >
                                                <label class="form-check-label mb-0" for="radioinline13">Yes</label>
                                            </div>
                                            <div class="form-check form-check-inline radio radio-primary">
                                                <input class="form-check-input" id="radioinline14" type="radio" data-rule="checked" name="is_artificial_abortion" value="2"
                                                       {if condition="$row&&$row.is_artificial_abortion eq '2'"} checked{/if}
                                                >
                                                <label class="form-check-label mb-0" for="radioinline14">No</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 m-t-10 position-relative
                                                       {if condition="$row&&$row.is_artificial_abortion=='2'"} ws_display_none{/if}
                                    ws_so_1" >
                                    <label class="form-label">If so, when? *</label>
                                    <input class="form-control"   name="artificial_abortion_content" type="text"   required=""
                                           {if condition="$row"} value="{$row.artificial_abortion_content|htmlentities}"{/if}
                                    >
                            </div>
                            <div class="col-md-12 m-t-10 position-relative">
                                <label class="form-label">Whether there is a history of miscarriages? *</label>

                                <div class="form-label">
                                    <div class="form-check form-check-inline radio radio-primary">
                                        <input class="form-check-input" id="radioinline15" type="radio" data-rule="checked" name="is_spontaneous_abortion" value="1"
                                               {if condition="$row&&$row.is_spontaneous_abortion eq '1'"} checked{/if}
                                        >
                                        <label class="form-check-label mb-0" for="radioinline15">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline radio radio-primary">
                                        <input class="form-check-input" id="radioinline16" type="radio" data-rule="checked" name="is_spontaneous_abortion" value="2"
                                               {if condition="$row&&$row.is_spontaneous_abortion eq '2'"} checked{/if}
                                        >
                                        <label class="form-check-label mb-0" for="radioinline16">No</label>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12 m-t-10 position-relative
                                         {if condition="$row&&$row.is_spontaneous_abortion=='2'"} ws_display_none{/if}
                            ws_so">
                            <label class="form-label">If so, when? *</label>
                            <input class="form-control"   name="spontaneous_abortion_content" type="text"  {if condition="$row"} value="{$row.spontaneous_abortion_content|htmlentities}"{/if} required="">
                        </div>

                        <div class="row m-t-10">
                            <div class="col-12 m-b-10" >
                                <button class="btn btn-primary" type="submit">Submit form</button>
                            </div>
                        </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Container-fluid Ends-->

</div>
<!-- Page content Ends-->

</div>



</div>

<!-- Page js Start-->
{include file="fa/js" /}
<!-- Page js Ends -->
<script>
    $('body').on('focus',".datetimepicker", function(){
        $(this).datetimepicker({
            locale:'en'
        });
    });
    //单选框按钮事件

    $('#radioinline16').click(function () {
        var is_spontaneous_abortion = $("input[name='is_spontaneous_abortion']:checked").val();
        if (is_spontaneous_abortion==2){
            $('.ws_so').css('display','none');
        }
    })
    $('#radioinline15').click(function () {
        var is_spontaneous_abortion = $("input[name='is_spontaneous_abortion']:checked").val();
        if (is_spontaneous_abortion==1){
            $('.ws_so').css('display','inline-block');
        }
    })


    $('#radioinline14').click(function () {
        var is_spontaneous_abortion = $("input[name='is_artificial_abortion']:checked").val();
        if (is_spontaneous_abortion==2){
            $('.ws_so_1').css('display','none');
        }
    })
    $('#radioinline13').click(function () {
        var is_spontaneous_abortion = $("input[name='is_artificial_abortion']:checked").val();
        if (is_spontaneous_abortion==1){
            $('.ws_so_1').css('display','inline-block');
        }
    })

    //删除baby表单事件
    $('#ws_row').on('click','.ws_del',function () {
        $(this).parents('.ws_card').prev().find('.ws_btn').css('display','inline-block');
        // $(this).parents('.ws_card').prev().find('.ws_btn').css('cssText','display:inline-block!important');
        $(this).parents('.ws_card').remove();
    });
</script>
<script>

    //j和q是单选按钮的class值
    var j = 60;
    var q = 90;
    //点击添加baby按钮事件
    $('#ws_row').on('click','.add_baby',function () {
        var i = $(this).attr('a');
        i++;
        j++;
        q++;
        var html = '';
        html += '<div class="col-xl-12 ws_card">';
        html +=   '<div class="card recent-order">';
        html +=     '<div class="card-header pb-0">';
        html +=        '<h3>Delivery #'+i+'</h3>';
        html +=        '<div class="card-header-right">';
        html +=           '<ul class="list-unstyled card-option" style="width: 230px;">';
        html +=           '<li><i class="icofont icofont-error close-card ws_del" ></i></li>';
        html +=           '</ul>';
        html +=         '</div>';
        html +=      '</div>';
        html +=      '<div class="card-body pb-0 m-b-30 m-t-20">';
        html +=         '<div class="col-md-4 m-t-10 position-relative">';
        html +=            '<label class="form-label" >Date of delivery *</label>';
        html +=            ' <input type="text"  name="birthday_time[]" data-rule="required" class="form-control datetimepicker" placeholder="" data-date-format="MM/DD/YYYY" />';
        html +=         '</div>';
        html +=         '<div class="col-md-4 m-t-10 position-relative">';
        html +=            '<label class="form-label">Sex *</label>';
        html +=            '<select class="form-select"  name="sex[]"data-rule="required">';
        html +=            '<option  value="0"  selected>Male</option>';
        html +=            '<option  value="1"  selected>Female</option>';
        html +=            '</select>';
        html +=          '</div>';
        html +=          '<div class="col-md-4 m-t-10 position-relative">';
        html +=          '<label class="form-label">Gestational week at birth *</label>';
        html +=          '<input name="fetal_age[]"  class="form-control " type="number" placeholder="week" min="0" data-rule="required">';
        html +=          '</div>';

        html +=            '<input name="baby[]"  class="form-control" value="'+i+'" readonly    type="hidden"   >';


        html +=          '<div class="col-md-4 m-t-10 position-relative">';
        html +=            '<label class="form-label" >Birth weight *</label>';
        html +=            '<input name="weight[]"  class="form-control " type="text" data-rule="required">';
        html +=          '</div>';
        html +=          '<div class="col-md-4 m-t-10 position-relative">';
        html +=            '<label class="form-label" >Birth height *</label>';
        html +=            '<input name="height[]"  class="form-control " type="text" data-rule="required">';
        html +=          '</div>';

        html +=          '<div class="col-md-4 m-t-10 position-relative">';
        html +=            '<label class="form-label">Pregnancy type *</label>';
        html +=            '<select class="form-select"  name="pregnancy_type[]" data-rule="required">';
        html +=               '<option  value="0"  selected>vaginal</option>';
        html +=               '<option  value="1" >c-section</option>';
        html +=             '</select>';
        html +=          '</div>';

        html +=           '<div class="col-md-12 m-t-10 position-relative">';
        html +=             '<label class="form-label" >Are there any complications? (If yes, please specify): *</label>';
        html +=             '<input name="complications[]"  class="form-control " type="text"  data-rule="required">';
        html +=           '</div>';


        html +=           '<div class="col-md-12 m-t-10 position-relative">';
        html +=             '<label class="form-label" >Are there any complications? (If yes, please specify): *</label>';
        html +=             '<input name="complications[]"  class="form-control " type="text"  data-rule="required">';
        html +=           '</div>';
        html +=           '<div class="col-md-12  m-t-10 position-relative">';
        html +=           ' <label class="form-label">Is this a surrogacy pregnancy? *</label>';
        html +=           ' <div class="form-label">';
        html +=           ' <div class="form-check form-check-inline radio radio-primary">';
        html +=           ' <input class="form-check-input" id="radioinline'+j+'" type="radio" data-rule="checked" name="is_surrogacy_pregnancy['+(i-1)+']" value="1">';
        html +=           ' <label class="form-check-label mb-0" for="radioinline'+j+'">Yes</label>';
        html +=           '  </div>';
        html +=           '  <div class="form-check form-check-inline radio radio-primary">';
        html +=           '  <input class="form-check-input" id="radioinline'+q+'" type="radio" data-rule="checked" name="is_surrogacy_pregnancy['+(i-1)+']" value="2">';
        html +=           '  <label class="form-check-label mb-0" for="radioinline'+q+'">No</label>';
        html +=           '  </div>';
        html +=           '  </div>';
        html +=           '  </div>';

        html +=           '<div class="col-md-12 m-t-20 ">';
        html +=             '<button class="btn btn-primary add_baby ws_btn"  a="'+i+'" type="button" style="margin-left: 40%">Add Delivery</button>';
        html +=           '</div>';
        html +=         '</div>';
        html +=        '</div>';
        html +=       '</div>';

        var form = $('#ws_row');

        //删除上一个baby的添加按钮
        // $('.ws_btn').html('')
        $(this).css('display','none')
        form.append(html);

    });
</script>
<script>
    //表单弹框事件
    function sumbit_sure(){

        var parmas = $("#obstetric_history").find("input[type=text]");
        var name_arr = ['last_period_time','days_of_bleed','days_between'];
        var j = 0;// 表单未完成数量
        var arr = [];// 表单未完成数组
        for(i=0;i<parmas.length;i++){
            var value = parmas[i].value;
            var name = $(parmas[i]).attr('name');
            if (name_arr.includes(name)&&value.length==0){
                j++;
                one = $(parmas[i]).prev().text();
                arr.push(one);
            }
        }
        $('#form_complate_number').val(j);

        var textarea = $("#obstetric_history").find("textarea");
        for(i=0;i<textarea.length;i++){
            var text = textarea[i].value;
            if (!text){
                j++;
                one = $(textarea[i]).prev().text();
                arr.push(one);
            }
        }


        var name_arr = ['is_menstruation_regular','is_artificial_abortion','is_spontaneous_abortion'];
        for(i=0;i<name_arr.length;i++){
            if (!$("input:radio[name='"+name_arr[i]+"']:checked").length){
                j++;
                one = $("input:radio[name='"+name_arr[i]+"']").parents('.form-label').prev().text();
                arr.push(one);
            }
        }

        $('#form_complate_number').val(j);
        var html = "Are you sure you want to exit？\n";
        if (j>0){
            html += j+" mandatory field\n";
            if(j==1){
                html += "'"+arr[0]+"'\n," ;

            }else if(j==2){
                html += "'"+arr[0]+"',\n" ;
                html += "'"+arr[1]+"',\n" ;
            }else{
                html += "'"+arr[0]+"',\n" ;
                html += "'"+arr[1]+"',\n" ;
                html += "'"+arr[2]+"'...\n" ;
            }
            html += "Not filled in.\n";
            html += "\n";
        }

        html += "Please fill in relevant information.";
        var gnl=confirm(html);
        if (gnl==true){
            if (j==0){
                return true;
            }else {
                return false;
            }
        }else{
            return false;
        }
    }
</script>
</body>
</html>
